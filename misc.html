<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        function captureConsole() {
            if (console.everything === undefined) {
                console.everything = [];
                let TS = _ => new Date().toLocaleString("sv", { timeZone: 'UTC' }) + "Z"; // timestamp function
                window.onerror = function (error, url, line) { // catches all console errors, includes those not made by console.error
                    console.everything.push({ type: "exception", timeStamp: TS(), value: { error, url, line } });
                    return false;
                }
                window.onunhandledrejection = function (e) { // catch some other things, idk
                    console.everything.push({ type: "promiseRejection", timeStamp: TS(), value: e.reason });
                }
                function hookLogType(logType) {
                    const original = console[logType].bind(console); // save orginal function
                    console["original" + logType] = original;
                    return function (...args) {
                        let info = new Error();
                        // original.apply(console, [{ info }]);
                        console.everything.push({
                            type: logType,
                            timeStamp: TS(),
                            args: Array.from(args),
                            trace: info.stack.trim().split("\n").pop(),
                        }); // add object to console.everything
                        original.apply(console, args); // log message to console
                    }
                }
                ['log', 'error', 'warn', 'debug', "group", "groupEnd", "groupCollapsed"].forEach(logType => { // hook each log type
                    console[logType] = hookLogType(logType)
                });
                console.saveState = function saveState() {
                    let everything = [...console.everything];
                    console.savedState = {
                        everything
                    };
                }
                console.restore = function restore() {
                    let { everything } = console.savedState;
                    console.everything = [...everything];
                    console.clear();
                    let max = Math.max(...console.everything.map(e => e.trace.length))
                    console.everything.forEach(function (log) {
                        if (original = console["original" + log.type]) {
                            original.apply(console, [...log.args, log.trace.padStart(max + 10, " ") + ", ", log.timeStamp]);
                        } else {
                            console.originalerror.apply(console, [...log.args]);
                        }
                    });
                }
            }
        }
        captureConsole();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        div#box {
            width: 200px;
            height: 20px;
            border: 1px solid black;
        }

        div#bar {
            height: 100%;
            background: red;
            display: inline-block;
        }

        body>div {
            width: 100%;
            height: 100%;
        }

        body>div>pre {
            display: inline-block;
            width: 50%;
            height: 100%;
            border: 1px solid black;
            box-sizing: border-box;
            padding: 10px;
        }

        span.add {
            background-color: green;
            color: white;
        }

        span.delete {
            background-color: red;
        }
    </style>
</head>

<body>
    <details>
        <summary>autosave</summary>
        <div id="autosave" style="border:1px solid black;width:100px;height:10px;">
            <div class="bar" style="background-color:red;height:100%"></div>
        </div>
        <div id="autosavestatus"></div>
        <textarea name="" id="" cols="30" rows="10"></textarea>
        <script>
            r = _ => console.log(document.querySelector("#autosavestatus").innerHTML = "autosave");
            let counter = 100;
            let seconds = 1;
            onkeydown = oninput = (_ => counter = 100);
            setInterval(_ => counter ? (counter--, document.querySelector("#autosavestatus").innerHTML = "", document.querySelector("#autosave .bar").style.width = counter + "%", !counter ? r() : 0) : 0, seconds * 10);
        </script>
    </details>
    <details>
        <summary>passthrough hovering/clicking</summary>
        <style>
            div.hovering {
                position: relative;
                height: 180px;
            }

            div.hovering>div.hover,
            /* div.hovering>div:hover, */
            div.hovering>div.keep-hover {
                border-color: red;
            }

            div.hovering>div:nth-child(1) {
                left: 10px;
                top: 10px;
            }

            div.hovering>div:nth-child(2) {
                left: 20px;
                top: 20px;
            }

            div.hovering>div:nth-child(3) {
                left: 30px;
                top: 30px;
            }

            div.hovering>div:nth-child(4) {
                left: 40px;
                top: 40px;
            }

            div.hovering>div:nth-child(5) {
                left: 50px;
                top: 50px;
            }

            div.hovering>div:nth-child(6) {
                left: 60px;
                top: 60px;
            }

            div.hovering>div {
                width: 100px;
                height: 100px;
                border: 2px solid green;
                position: absolute;
                background-color: #0002;
                content: attr(data-value)
            }
        </style>
        <div class="hovering">
            <div data-value="1"></div>
            <div data-value="2"></div>
            <div data-value="3"></div>
            <div data-value="4"></div>
            <div data-value="5"></div>
            <div data-value="6"></div>
        </div>
        <div id="value-display"></div>
        <script>
            function readHoveredDivs() {
                let els = Array.from(document.querySelectorAll(".hovering>div.keep-hover,.hovering>div.hover")); // get all elements that are kept or hovered
                let values = els.map(e => e.dataset.value); // get each element's value
                document.getElementById("value-display").innerHTML = values.join(","); // join array of values with comma and set innerhtml
            }
            function captureMouse(keep, cls) { // wrapper function for ease of use
                return function (event) {
                    document.querySelectorAll("div.hovering>div." + cls).forEach(e => e.classList.remove(cls)); // clear class from all elements that have it
                    if (keep && document.querySelector("div.hovering>div.keep-hover")) return; // return if keep-hover detected
                    let { clientX, clientY } = event; // get x/y coordinates of event
                    document.elementsFromPoint(clientX, clientY).forEach(e => { // get all elements that overlap the coordinates
                        if (e.matches("div.hovering>div")) { // if element is a valid target element
                            e.classList.add(cls); // add the class
                        }
                    });
                    readHoveredDivs(); // update info display
                }
            }
            window.onmousemove = captureMouse(true, "hover"); // highlight divs on hover
            window.onclick = captureMouse(false, "keep-hover"); // toggle highlight divs on click
        </script>
    </details>
</body>

</html>