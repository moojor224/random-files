<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        function captureConsole() {
            if (console.everything === undefined) {
                console.everything = [];
                let TS = _ => new Date().toLocaleString("sv", { timeZone: 'UTC' }) + "Z"; // timestamp function
                window.onerror = function (error, url, line) { // catches all console errors, includes those not made by console.error
                    console.everything.push({ type: "exception", timeStamp: TS(), value: { error, url, line } });
                    return false;
                }
                window.onunhandledrejection = function (e) { // catch some other things, idk
                    console.everything.push({ type: "promiseRejection", timeStamp: TS(), value: e.reason });
                }
                function hookLogType(logType) {
                    const original = console[logType].bind(console); // save orginal function
                    console["original" + logType] = original;
                    return function (...args) {
                        let info = new Error();
                        // original.apply(console, [{ info }]);
                        console.everything.push({
                            type: logType,
                            timeStamp: TS(),
                            args: Array.from(args),
                            trace: info.stack.trim().split("\n").pop(),
                        }); // add object to console.everything
                        original.apply(console, args); // log message to console
                    }
                }
                ['log', 'error', 'warn', 'debug', "group", "groupEnd", "groupCollapsed"].forEach(logType => { // hook each log type
                    console[logType] = hookLogType(logType)
                });
                console.saveState = function saveState() {
                    let everything = [...console.everything];
                    console.savedState = {
                        everything
                    };
                }
                console.restore = function restore() {
                    let { everything } = console.savedState;
                    console.everything = [...everything];
                    console.clear();
                    let max = Math.max(...console.everything.map(e => e.trace.length))
                    console.everything.forEach(function (log) {
                        if (original = console["original" + log.type]) {
                            original.apply(console, [...log.args, log.trace.padStart(max + 10, " ") + ", ", log.timeStamp]);
                        } else {
                            console.originalerror.apply(console, [...log.args]);
                        }
                    });
                }
            }
        }
        captureConsole();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <title>Hello World</title>
    <script src="./js/react.development.js"></script>
    <script src="./js/react-dom.development.js"></script>
    <script src="./js/babel.min.js"></script>
    <style>
        div#box {
            width: 200px;
            height: 20px;
            border: 1px solid black;
        }

        div#bar {
            height: 100%;
            background: red;
            display: inline-block;
        }

        body>div {
            width: 100%;
            height: 100%;
        }

        body>div>pre {
            display: inline-block;
            width: 50%;
            height: 100%;
            border: 1px solid black;
            box-sizing: border-box;
            padding: 10px;
        }

        span.add {
            background-color: green;
            color: white;
        }

        span.delete {
            background-color: red;
        }
    </style>
</head>

<body>
    <details>
        <summary>autosave</summary>
        <div id="autosave" style="border:1px solid black;width:100px;height:10px;">
            <div class="bar" style="background-color:red;height:100%"></div>
        </div>
        <div id="autosavestatus"></div>
        <textarea name="" id="autosaveeditor" cols="30" rows="10"></textarea>
        <script>
            r = _ => console.log(document.querySelector("#autosavestatus").innerHTML = "Saved!");
            let counter = 100;
            let seconds = 1;
            document.querySelector("#autosaveeditor").oninput = (_ => counter = 100);
            setInterval(_ => counter ? (counter--, document.querySelector("#autosavestatus").innerHTML = "Waiting...", document.querySelector("#autosave .bar").style.width = counter + "%", !counter ? r() : 0) : 0, seconds * 10);
        </script>
    </details>
    <details>
        <summary>passthrough hovering/clicking</summary>
        <style>
            div.hovering {
                position: relative;
                height: 180px;
            }

            div.hovering>div.hover,
            /* div.hovering>div:hover, */
            div.hovering>div.keep-hover {
                border-color: red;
            }

            div.hovering>div:nth-child(1) {
                left: 10px;
                top: 10px;
            }

            div.hovering>div:nth-child(2) {
                left: 20px;
                top: 20px;
            }

            div.hovering>div:nth-child(3) {
                left: 30px;
                top: 30px;
            }

            div.hovering>div:nth-child(4) {
                left: 40px;
                top: 40px;
            }

            div.hovering>div:nth-child(5) {
                left: 50px;
                top: 50px;
            }

            div.hovering>div:nth-child(6) {
                left: 60px;
                top: 60px;
            }

            div.hovering>div {
                width: 100px;
                height: 100px;
                border: 2px solid green;
                position: absolute;
                background-color: #0002;
                content: attr(data-value)
            }
        </style>
        <div class="hovering">
            <div data-value="1"></div>
            <div data-value="2"></div>
            <div data-value="3"></div>
            <div data-value="4"></div>
            <div data-value="5"></div>
            <div data-value="6"></div>
        </div>
        <div id="value-display"></div>
        <script>
            function readHoveredDivs() {
                let els = Array.from(document.querySelectorAll(".hovering>div.keep-hover,.hovering>div.hover")); // get all elements that are kept or hovered
                let values = els.map(e => e.dataset.value); // get each element's value
                document.getElementById("value-display").innerHTML = values.join(","); // join array of values with comma and set innerhtml
            }
            function captureMouse(keep, cls) { // wrapper function for ease of use
                return function (event) {
                    document.querySelectorAll("div.hovering>div." + cls).forEach(e => e.classList.remove(cls)); // clear class from all elements that have it
                    if (keep && document.querySelector("div.hovering>div.keep-hover")) return; // return if keep-hover detected
                    let { clientX, clientY } = event; // get x/y coordinates of event
                    document.elementsFromPoint(clientX, clientY).forEach(e => { // get all elements that overlap the coordinates
                        if (e.matches("div.hovering>div")) { // if element is a valid target element
                            e.classList.add(cls); // add the class
                        }
                    });
                    readHoveredDivs(); // update info display
                }
            }
            window.onmousemove = captureMouse(true, "hover"); // highlight divs on hover
            window.onclick = captureMouse(false, "keep-hover"); // toggle highlight divs on click
        </script>
    </details>
    <style>
        div.calendar {
            --day-size: 60px;
            border: 1px solid black;
            display: inline-block;
        }

        div.calendar div.day {
            height: var(--day-size);
            width: var(--day-size);
            display: inline-block;
            border: 1px solid black;
            box-sizing: border-box;
        }
    </style>
    <div id="root"></div>
    <script type="text/babel">

        function convert(amount, type) {
            let millis = amount;
            if (!checkValidTime(type)) throw new Error(`invalid time range: "${type}"`);
            switch (type.trim().toLowerCase()) {
                case "week": return convert(amount * 7, "day");
                case "year": millis *= 365;
                case "day": millis *= 24;
                case "hour": millis *= 60;
                case "minute": millis *= 60;
                case "second": millis *= 1000;
                // case "millisecond": millis *= 1;
            }
            return millis;
        }
        function checkValidTime(type) {
            return ["year", "month", "week", "day", "hour", "minute", "second", "millisecond"].includes(type.trim().toLowerCase());
        }
        (function () {
            String.prototype.capitalize = function () {
                return this.charAt(0).toUpperCase() + this.slice(1);
            }
            Date.prototype.startOf = function (type) {
                return _Of.call(this, type, { mod: "startOf", M: 0, MO: 0, w: 1, D: 1, h: 0, m: 0, s: 0, ms: 0 });
            }
            Date.prototype.endOf = function (type) {
                return _Of.call(this, type, { mod: "endOf", M: 11, MO: 1, w: 7, D: 0, h: 23, m: 59, s: 59, ms: 999 });
            }
            Date.prototype.add = function (amount, type) {
                return _Math.call(this, amount, type);
            }
            Date.prototype.subtract = function (amount, type) {
                return _Math.call(this, -amount, type);
            }
            function _Of(type, { mod, M, MO, w, D, h, m, s, ms }) {
                if (!checkValidTime(type)) throw new Error(`invalid time range: "${type}"`);
                let d = new Date(this);
                switch (type.trim().toLowerCase()) {
                    case "week":
                        d.setDate(d.getDate() + (w - (d.getDay() + 1)));
                        d = d[mod]("day");
                        break;
                    case "year": d.setMonth(M);
                    case "month":
                        d.setMonth(d.getMonth() + MO);
                        d.setDate(D);
                    case "day": d.setHours(h);
                    case "hour": d.setMinutes(m);
                    case "minute": d.setSeconds(s);
                    case "second": d.setMilliseconds(ms);
                }
                return d;
            }
            function _Math(amount, t) {
                let type = t.trim().toLowerCase();
                if (!checkValidTime(type)) throw new Error(`invalid time range: "${type}"`);
                let d = new Date(this);
                switch (type.trim().toLowerCase()) {
                    case "week": d.setDate(d.getDate() + 7 * amount); break;
                    case "year": d.setYear(d.getYear() + amount); break;
                    case "month": d.setMonth(d.getMonth() + amount); break;
                    case "day": d.setDate(d.getDate() + amount); break;
                    case "hour": d.setHours(d.getHours() + amount); break;
                    case "minute": d.setMinutes(d.getMinutes() + amount); break;
                    case "second": d.setSeconds(d.getSeconds() + amount); break;
                }
                // d.setTime(d.getTime() + convert(amount, type));
                return d;
            }
        })();
        let key = 0;
        let days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        let months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        let today = new Date();
        const firstDayOfMonth = (d => (d.setDate(1), d.getDay()))(new Date(today));
        console.log(days[firstDayOfMonth]);

        function Week({ start, end = new Date(start).endOf("week") }) {
            let curDate = start;
            let arr = new Array(7).fill(0).map(d => {
                let date = curDate;
                curDate = curDate.add(1, "day");
                return (
                    <div key={key++} className={["day", months[date.getMonth()], days[date.getDay()]].join(" ")}>
                        {date.getDate()}
                    </div>
                );
            });
            return (
                <div className="week">
                    {arr}
                </div>
            );
        }

        function Calendar({ m = new Date() }) {
            let [month, setMonth] = React.useState(m);
            let arr = [];
            let firstWeekStart = month.startOf("month").startOf("week");
            let lastWeekEnd = month.endOf("month").endOf("week");
            console.log("first week start", firstWeekStart);
            console.log("last week end", lastWeekEnd);
            let count = 0;
            let curDate = firstWeekStart;
            console.log(arr);
            while (count < 100) {
                if (curDate.getTime() > lastWeekEnd.getTime()) {
                    break;
                }
                arr.push(curDate);
                curDate = curDate.add(1, "week");
                count++;
            }
            console.log(arr);
            return (
                <>
                    <style>
                        {"div.calendar." + months[month.getMonth()] + " div.day:not(." + months[month.getMonth()] + ")"} {`{`}
                        color: darkgray;
                        {`}`}
                    </style>
                    <div className={["calendar", months[month.getMonth()]].join(" ")}>
                        <div style={{
                            width: "100%",
                            height: "30px",
                            margin: "auto",
                            display: "grid",
                            gridTemplateColumns: "auto 1fr auto"
                        }}><button onClick={function () {
                            setMonth(month.subtract(1, "month"));
                        }}>&larr;</button><h2 style={{
                            margin: "auto",
                            padding: 0,
                            display: "inline-block"
                        }}>{months[month.getMonth()]} {month.getFullYear()}</h2><button onClick={function () {
                            setMonth(month.add(1, "month"));
                        }}>&rarr;</button></div>
                        {arr.map(e => <Week start={e} end={e.endOf("week")} key={key++} />)}
                    </div>
                </>
            );
        }
        var a = new Date();
        // console.log("today plus a day", a.add(1, "day").toLocaleString());
        // console.log("today plus a week", a.add(1, "week").toLocaleString());
        // console.log("today plus a month", a.add(1, "month").toLocaleString());
        // console.log("today plus a year", a.add(1, "year").toLocaleString());

        // console.log();

        // console.log("today minus a day", a.subtract(1, "day").toLocaleString());
        // console.log("today minus a week", a.subtract(1, "week").toLocaleString());
        // console.log("today minus a month", a.subtract(1, "month").toLocaleString());
        // console.log("today minus a year", a.subtract(1, "year").toLocaleString());
        let monthToRender = new Date();
        let calendar = <Calendar month={monthToRender} />;
        ReactDOM.createRoot(document.getElementById('root')).render(calendar);
    </script>
</body>

</html>